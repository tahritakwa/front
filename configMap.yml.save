apiVersion: v1
kind: ConfigMap
metadata:
  name: stark-config
data:
  nginx.conf: |
    worker_processes 1;
    #pid /run/nginx.pid;
    events { 
    worker_connections 1024;
     }
    http {

        map $http_upgrade $connection_upgrade {

apiVersion: v1
kind: ConfigMap
metadata:
  name: stark-config
data:
  nginx.conf: |
    worker_processes 1;
            default upgrade;

            ''      close;

    }
    server { 
    listen 80; 
    server_name 10.10.10.93; 
    root /usr/share/nginx/html; 
    index index.php index.html index.htm;
    include /etc/nginx/mime.types;
    gzip on;
    gzip_min_length 1000;

    gzip_proxied expired no-cache no-store private auth;

    gzip_types text/plain text/css application/json application/javascript application/x-javascript text/xml application/xml application/xml+rss text/javascript;

       

    keepalive_timeout  300;

    fastcgi_read_timeout 300;

    proxy_read_timeout 300;

    client_max_body_size 100M;

    location / {
    #front location context
        try_files $uri $uri/ /index.html;
     }
    location /api/ {
    # # commercial location context
        proxy_pass http://comm-service:80/api/ ;
        proxy_http_version 1.1;

        proxy_set_header Upgrade $http_upgrade;

        proxy_set_header Connection $http_connection;

     }
    location /api/auth {
    # # authentification location context
        proxy_pass http://auth-service:8080/api/auth ;
        proxy_http_version 1.1;

        proxy_set_header Upgrade $http_upgrade;

        proxy_set_header Connection $http_connection;

     }
    location /api/ {
    # # accounting location context
        proxy_pass http://acct-service:8080/api/ ;
        proxy_http_version 1.1;

        proxy_set_header Upgrade $http_upgrade;

        proxy_set_header Connection $http_connection;

     }
    location ~ \.html$ {

      add_header Cache-Control "private, no-cache, no-store, must-revalidate";

      add_header Expires "Sat, 01 Jan 2000 00:00:00 GMT";

      add_header Pragma no-cache;

      }

      }
     }
