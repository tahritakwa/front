<div class="card full-screen-card mb-5">
  <div class="card-header" *ngIf="!isModalOption">
    <div class="col-sm-12 mt-1">
      <h3 class="card-title mb-0">
        {{ (isUpdateMode ? 'EDIT_TEMPLATE_ACCOUNTING' : 'NEW_TEMPLATE_ACCOUNTING') |translate }}</h3>
    </div>
  </div>
  <div class="card-body">
    <form class="form-horizontal" [formGroup]="templateAccountingFormGroup">
      <div class="col-lg-12 col-sm-12 col-md-12 mr-5">
        <div class="form-group row">
          <div class="col-lg-5 col-md-12 col-sm-12">
            <label class="col-lg-12 col-md-12 col-sm-12">{{'LABEL'|translate}}<span class="required">*</span></label>
            <input #templateAccountinglabel class="form-control" name="label" formControlName="label"
              minlength="{{minLength}}" maxlength="{{maxLength}}">
            <app-control-messages [control]="templateAccountingFormGroup.controls.label"
              class="error-msg messages text-left text-danger">
            </app-control-messages>
          </div>
          <div class="col-lg-5 col-md-12 col-sm-12">
            <label class="col-lg-12 col-md-12 col-sm-12">{{'JOURNAL'|translate}}<span class="required">*</span></label>
            <kendo-combobox formControlName="journalId" [data]="journalFiltredList" [textField]="'label'"
              [valueField]="'id'" class="form-control" [valuePrimitive]="true" [filterable]="true"
              (filterChange)="handleFilterJournal($event)" [ngModel]="value">

              <ng-template kendoDropDownListFooterTemplate>
                <app-drop-down-footer [addNew]="addNewJournal.bind(this)"></app-drop-down-footer>
              </ng-template>
<!--No data template-->
<ng-template kendoDropDownListNoDataTemplate>
  <h5><br/> {{'NO_DATA_FOUND'|translate}}</h5>
</ng-template>
<kendo-combobox-messages clearTitle="{{'CLEAR'|translate}}"> </kendo-combobox-messages>
            </kendo-combobox>
            <app-control-messages [control]="templateAccountingFormGroup.controls.journalId"
              class="error-msg messages text-left text-danger"></app-control-messages>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="tab-pane active show" role="tabpanel" [ngStyle]="{'overflow-y': 'auto'}">
          <kendo-grid #grid [data]="templateAccountingDetails" [pageSize]="gridSettings.state.take"
            [skip]="gridSettings.state.skip" [sort]="gridSettings.state.sort" [filter]="gridSettings.state.filter"
            (cellClick)="lineClickHandler($event)" (cancel)="cancelHandler($event)" (save)="saveHandler($event)"
            (remove)="removeHandler($event)" (add)="addHandler($event)" [sortable]="true"
            [reorderable]="true" [columnMenu]="false"
            (keypress)="keyEnterSaveAction(grid,this.templateAccountingDetailsForm, $event)" >
            <ng-template kendoGridToolbarTemplate [position]="'top'">
              <!-- Head Start-->
                <div *ngIf="hasAuthorityAddOrUpdate()" class="row" style="float :right;">
                  <app-btn-grid class="col" [advencedAdd]='false' [add]='true' [title]="'ADD_LINE'"></app-btn-grid>
                </div>
              <!-- Head end-->
            </ng-template>

            <!-- accountId -->
            <kendo-grid-column [field]="gridSettings.columnsConfig[0].field"
            [title]="gridSettings.columnsConfig[0].title | translate"
            [filterable]="gridSettings.columnsConfig[1].filterable">
            <ng-template kendoGridCellTemplate let-dataItem>
              {{dataItem.codeAccount}}
            </ng-template>
            <ng-template kendoGridEditTemplate let-dataItem>
            <div [formGroup]="templateAccountingDetailsForm">
              <kendo-combobox class="form-control" [data]="accountFiltredList" [textField]="'code'"
              [valueField]="'id'" formControlName="accountId" [valuePrimitive]="true" [filterable]="true"
              (filterChange)="handleFilterAccount($event)" (valueChange)="setLabelOnSelectAccount($event)"
              (selectionChange)="selectionChangeAccountDropdown($event)">
              <ng-template kendoDropDownListFooterTemplate>
                <app-drop-down-footer *ngIf="showAddAcount" [addNew]="addNewAccount.bind(this)">
                </app-drop-down-footer>
              </ng-template>

              <ng-template kendoComboBoxItemTemplate let-dataItem>
                <div class="container">
                  <div class="row">
                    <b>{{dataItem.code}}</b>
                  </div>
                  <div class="row">
                    <span class="small">{{dataItem.label}}</span>
                  </div>
                </div>
              </ng-template>
              <!--No data template-->
              <ng-template kendoDropDownListNoDataTemplate>
                <h5><br/> {{'NO_DATA_FOUND'|translate}}</h5>
              </ng-template>
              <kendo-combobox-messages clearTitle="{{'CLEAR'|translate}}"> </kendo-combobox-messages>
            </kendo-combobox>
            </div>
            <ng-template kendoDropDownListFooterTemplate>
              <app-drop-down-footer *ngIf="this.authService.hasAuthority(this.AccountingPermissions.ADD_ACCOUNTING_ACCOUNTS)" [addNew]="addNewAccount.bind(this)"></app-drop-down-footer>
            </ng-template>

            <i #anchoraccountId></i>
            <app-control-message-grid-cell [group]="templateAccountingDetailsForm" [anchor]="anchoraccountId"
              controlName="accountId">
            </app-control-message-grid-cell>
          </ng-template>
          </kendo-grid-column>
              <!-- nameAccount -->
            <kendo-grid-column [field]="gridSettings.columnsConfig[1].field"
            [title]="gridSettings.columnsConfig[1].title | translate"
            [filterable]="gridSettings.columnsConfig[1].filterable"
            [width]="gridSettings.columnsConfig[1]._width">
            <ng-template kendoGridEditTemplate let-dataItem>
              <form [formGroup]="templateAccountingDetailsForm">
                <input class="form-control" type="text" name="nameAccount" formControlName="nameAccount"
                minlength="{{minLength}}" maxlength="{{maxLength}}">
               </form>
            </ng-template>
            </kendo-grid-column>
             <!-- label -->
             <kendo-grid-column [field]="gridSettings.columnsConfig[2].field"
             [title]="gridSettings.columnsConfig[2].title | translate"
             [filterable]="gridSettings.columnsConfig[2].filterable"
             [width]="gridSettings.columnsConfig[2]._width">

            <ng-template kendoGridEditTemplate let-dataItem>
              <form [formGroup]="templateAccountingDetailsForm">
              <input class="form-control" type="text" name="label" formControlName="label"
                      minlength="{{minLength}}" maxlength="{{maxLength}}">
                    <i #anchorLabel></i>
                    <app-control-message-grid-cell [group]="templateAccountingDetailsForm" [anchor]="anchorLabel"
                      controlName="label">
                    </app-control-message-grid-cell>
                </form>
            </ng-template>
            </kendo-grid-column>
             <!-- debitAmount -->
             <kendo-grid-column [field]="gridSettings.columnsConfig[3].field"
             [title]="gridSettings.columnsConfig[3].title | translate"
             [format]="formatNumberOptions" class="amount-field"
             [width]="gridSettings.columnsConfig[3]._width">
            <ng-template kendoGridEditTemplate let-dataItem>
              <form [formGroup]="templateAccountingDetailsForm">
                <kendo-numerictextbox class="form-control" formControlName="debitAmount" [autoCorrect]=true
                  [format]="formatNumberOptions" [decimals]=purchasePrecision [min]="minAmountNumber"
                  [max]="maxAmountNumber" (keyup)="changeCreditAmount($event)" style="padding-right: 1rem;">
                </kendo-numerictextbox>
                <i #anchorCreditAmount></i>
                <app-control-message-grid-cell [group]="templateAccountingDetailsForm" [anchor]="anchorCreditAmount"
                  controlName="debitAmount">
                </app-control-message-grid-cell>
              </form>
            </ng-template>
            </kendo-grid-column>
            <!-- creditAmount -->
            <kendo-grid-column [field]="gridSettings.columnsConfig[4].field"
            [title]="gridSettings.columnsConfig[4].title | translate"
            [format]="formatNumberOptions" class="amount-field"
            [width]="gridSettings.columnsConfig[4]._width">
            <ng-template kendoGridEditTemplate let-dataItem>
              <form [formGroup]="templateAccountingDetailsForm">
                <kendo-numerictextbox class="form-control" formControlName="creditAmount" [autoCorrect]=true
                      [format]="formatNumberOptions" [decimals]=purchasePrecision [min]="minAmountNumber"
                      [max]="maxAmountNumber" (keyup)="changeDebitAmount($event)" style="padding-right: 1rem;">
                    </kendo-numerictextbox>
                    <i #anchorCreditAmount></i>
                    <app-control-message-grid-cell [group]="templateAccountingDetailsForm" [anchor]="anchorCreditAmount"
                      controlName="creditAmount">
                    </app-control-message-grid-cell>
              </form>
            </ng-template>
            </kendo-grid-column>
            <kendo-grid-command-column [width]="100"  [footerStyle]="{'background-color':'#fff'}">
              <ng-template kendoGridCellTemplate let-isNew="isNew" let-dataItem="dataItem">
                <button type="button" kendoGridSaveCommand *ngIf="hasAuthorityAddOrUpdate() && accountDropDownIsInEditingMode"
                        class='noPadding btn-Add' [tooltip]="save" content-type="template" [show-delay]="showDelay">
                  <i class="save-icon fa fa-check fa-lg" aria-hidden="true"></i>
                </button>
                <button type="button" kendoGridCancelCommand *ngIf="hasAuthorityAddOrUpdate() && accountDropDownIsInEditingMode"
                        class="noPadding btn-Add k-button" [tooltip]="discard" content-type="template"
                        [show-delay]="showDelay">
                  <i class="fa fa-ban fa-lg" style="color: #E91E63;" aria-hidden="true"></i>
                </button>
                <button type="button" kendoGridRemoveCommand *ngIf="hasAuthorityAddOrUpdate() && !accountDropDownIsInEditingMode"
                        class="noPadding btn-Add k-button" dir="ltr" style="border: none; color: #E91E63 !important;"
                        [tooltip]="remove" [show-delay]="showDelay" content-type="template">
                  <i class="fa fa-times fa-lg"></i>
                </button>
                <!--tooltip-->
                <ng-template #save>
                  <strong>{{'SAVE'|translate}}</strong>
                </ng-template>
                <ng-template #discard>
                  <strong>{{'CANCEL'|translate}}</strong>
                </ng-template>
                <ng-template #remove>
                  <strong>{{'DELETE'|translate}}</strong>
                </ng-template>
              </ng-template>
            </kendo-grid-command-column>
          </kendo-grid>
        </div>
      </div>

    </form>
  </div>
  <!--Begin Card footer-->
  <div class="fixed-card-footer">
    <div>
      <footer class="app-footer mx-0">
        <div class="w-100">
          <div class="d-flex justify-content-end p-3 footer-content">
            <a *ngIf="!isOpenDialogMode()" routerLink='/main/settings/accounting/template'>
            <span class="btn btn-sm btn-back-to-list">
              <i class="fa fa-chevron-circle-left"></i> {{'BACK_TO_LIST'|translate}}
            </span>
            </a>
            <button *ngIf="hasAuthorityAddOrUpdate()" (click)="saveTemplateClick()" class="btn btn-sm btn-save mx-1" type="button">
              <i class="fa fa-floppy-o"></i> {{'SAVE'|translate}}
            </button>
          </div>
        </div>
      </footer>
    </div>
  </div>
  <!--End Card footer-->
</div>
