<div class="card border-0">
  <div class="card-content">
    <div class="col-lg-10 col-sm-12 col-md-12">
      <div class="row">
        <div class="col-lg-4 col-md-4 col-sm-4 mt-5">
          <div *ngIf="!isMasterUsersList">
            <kendo-combobox class="form-control" [valueField]="'value'" [data]="usersStates"
                            [valuePrimitive]="true"
                            [textField]="'name'" [value]="defaultUsersState"
                            (valueChange)="onCheckAllUsers($event)">
              <ng-template kendoComboBoxItemTemplate let-dataItem>
                <div class="container">
                  <div class="row">
                    <span>{{dataItem.name}}</span>
                  </div>
                </div>
              </ng-template>
              <!--No data template-->
              <ng-template kendoDropDownListNoDataTemplate>
                <h5><br/> {{'NO_DATA_FOUND'|translate}}</h5>
              </ng-template>
              <kendo-combobox-messages clearTitle="{{'CLEAR'|translate}}"> </kendo-combobox-messages>
            </kendo-combobox>
          </div>
        </div>
      </div>
    </div>

    <div class="card-body">
      <kendo-grid [data]="gridSettings.gridData" [pageSize]="gridSettings.state.take" [skip]="gridSettings.state.skip"
                  [sortable]="true" [pageable]="pagerSettings" [reorderable]="true" [columnMenu]="false"
                  [selectable]="{enabled: true, checkboxOnly: true }"
                  (selectedKeysChange)="onSelectedKeysChange()"
                  [kendoGridSelectBy]="'Id'" [selectedKeys]="usersIdsSelected" (remove)="removeHandler($event.Email)"
                  (sortChange)="sortChange($event)" [sort]="gridSettings.state.sort"
                  [filter]="gridSettings.state.filter"
                  (dataStateChange)="dataStateChange($event)" [selectable]="true">

        <ng-template kendoGridToolbarTemplate class="row">
          <div class="col-lg-12 col-sm-12 col-md-12 p-0">
            <div class="row">
              <div class="col-lg-4 col-sm-4 col-md-4 pr-2 pl-0">
                <app-search-user (sendData)="receiveData($event)"></app-search-user>
              </div>
              <div class="col-lg-8 col-sm-8 col-md-8" *ngIf="!isMasterUsersList" style="text-align :right;">
                <button *ngIf="!isMasterUsersList" class="synchronized ml-3 mr-2" type="button" tabindex="0"
                        (click)="synchronizeWithMaster()">
                  <i class="fa fa-cogs fa-lg AddIcon"></i>
                  <span>&nbsp;{{'SYNCHRONIZE_WITH_MASTER' | translate}}</span>
                </button>

                <app-btn-grid
                  [advencedAdd]='!isMasterUsersList && hasAddPermission'
                  [add]='false'
                  [isExportExcel]="true"
                  [addLink]='"Add"'
                  [isExportModel]="true"
                  [isImportFile]="true"
                  [isDesactivate]="true"
                  [isReactivate]="true"
                  [isDelete]="true"
                  [Config]= "config"
                  [predicate]="predicate"
                  [gridSettings]="gridSettings"
                  [fileName]="'LIST_USER'|translate"
                  [service]="userService"
                  (incomingFileEvent)="incomingFile($event)" (downLoadFileEvent)="downLoadFile($event)"
                  (desactivateItemsUsers)="openDesactivateusersdetails(true, usersIdsSelected)"
                  (reactivateItemsUsers)="openDesactivateusersdetails(false, usersIdsSelected)"
                  (deleteSelectedItems)="deleteSelectedItems()"
                  style="display: inline-flex;"></app-btn-grid>
              </div>
            </div>

          </div>

        </ng-template>
        <!-- Head end-->
        <!--Check box Start -->
        <kendo-grid-checkbox-column [width]="60" *ngIf="!isMasterUsersList">
          <ng-template kendoGridHeaderTemplate>
            <input class="k-checkbox" id="selectAllCheckboxId" kendoGridSelectAllCheckbox [state]="selectAllState">
            <label class="k-checkbox-label" for="selectAllCheckboxId"></label>
          </ng-template>
        </kendo-grid-checkbox-column>
        <!--Check box End -->

        <!-- User -->
        <kendo-grid-column [title]="gridSettings.columnsConfig[1].title | translate"
                           [width]="gridSettings.columnsConfig[1]._width"
                           [filter]="gridSettings.columnsConfig[1].filter"
                           [filterable]="gridSettings.columnsConfig[1].filterable"
                           [format]="gridSettings.columnsConfig[1].format"
                           [tooltip]="gridSettings.columnsConfig[1].title"
                           [field]="gridSettings.columnsConfig[1].field" [columnMenu]="false">
          <ng-template kendoGridHeaderTemplate>
                        <span tooltip="{{gridSettings.columnsConfig[1].title | translate}}"
                              theme="light">{{gridSettings.columnsConfig[1].title | translate}}</span>
          </ng-template>
          <ng-template kendoGridCellTemplate let-dataItem>
            <div class="row d-flex align-items-center cursor-pointer" [ngClass]="{'cursor-pointer': hasShowPermission || hasUpdatePermission}"
            (click)="hasShowPermission || hasUpdatePermission ? goToProfile(dataItem) : ''">
              <div class="col-auto">
                <img id="blah" class="rounded-circle card-avatar"
                [src]="dataItem.image" alt="avatar"/>
              </div>
              <div class="col pl-0">
                <span class="tiers-title"> {{dataItem.FirstName}} {{dataItem.LastName}} </span>
              </div>
            </div>
          </ng-template>
        </kendo-grid-column>
        <!--LastName End-->
        <!--Mail Start-->
        <kendo-grid-column [field]="gridSettings.columnsConfig[3].field" *ngIf="!isMasterUsersList"
          [title]="gridSettings.columnsConfig[3].title | translate" [width]="gridSettings.columnsConfig[3]._width"
          [filter]="gridSettings.columnsConfig[3].filter" [filterable]="gridSettings.columnsConfig[3].filterable"
          [format]="gridSettings.columnsConfig[3].format">
          <ng-template kendoGridEditTemplate>
          </ng-template>
        </kendo-grid-column>
        <!--Mail End-->
        <!--User company Start-->
        <kendo-grid-column *ngIf="isMasterUsersList" [field]="gridSettings.columnsConfig[4].field"
          [title]="gridSettings.columnsConfig[4].title | translate" [width]="gridSettings.columnsConfig[4]._width"
          [filter]="gridSettings.columnsConfig[4].filter" [filterable]="gridSettings.columnsConfig[4].filterable"
          [format]="gridSettings.columnsConfig[4].format">
          <!-- <ng-template kendoGridEditTemplate>
          </ng-template>    -->
          <ng-template kendoGridCellTemplate let-dataItem>
            <div *ngIf="dataItem">
              <span *ngFor="let userCompany of dataItem.MasterUserCompany">
                <span class="RoleClass" *ngIf="userCompany.IsActif"
                      style="border: 2px solid hsl(184, 32%, 53%) !important; padding: 3px;">
                  <span
                    *ngIf="userCompany.IdMasterCompanyNavigation">{{userCompany.IdMasterCompanyNavigation.Name}}</span>
                </span>
                <span class="RoleClass" *ngIf="!userCompany.IsActif"
                      style="border: 2px solid hsl(355, 87%, 36%) !important; padding: 3px;">
                  <span
                    *ngIf="userCompany.IdMasterCompanyNavigation">{{userCompany.IdMasterCompanyNavigation.Name}}</span>
                </span>

              </span>
            </div>
          </ng-template>
        </kendo-grid-column>
        <!--User company End-->
        <!--Role Start-->
        <kendo-grid-column [width]="160" *ngIf="!isMasterUsersList" [field]="gridSettings.columnsConfig[5].field"
          [title]="gridSettings.columnsConfig[5].title | translate" [width]="gridSettings.columnsConfig[5]._width"
          [filter]="gridSettings.columnsConfig[5].filter" [filterable]="gridSettings.columnsConfig[5].filterable"
          [format]="gridSettings.columnsConfig[5].format" [headerStyle]="{'text-align': 'center'}"
                           [style]="{'text-align': 'center'}">
          <ng-template kendoGridCellTemplate let-dataItem>
            <div *ngIf="dataItem.MasterRoleUser">
              <span *ngFor="let userRole of dataItem.MasterRoleUser" class="RoleClass"
                    style="border: 2px solid hsl(184, 32%, 53%) !important; padding: 3px;">
                <span *ngIf="userRole.IdRoleNavigation">{{userRole.IdRoleNavigation.Label}}</span>
              </span>
            </div>
        </ng-template>
        </kendo-grid-column>
        <!--Role End-->
        <!-- Company associated -->
        <kendo-grid-column *ngIf="!isMasterUsersList" [field]="gridSettings.columnsConfig[6].field"
          [title]="gridSettings.columnsConfig[6].title | translate" [width]="gridSettings.columnsConfig[6]._width"
          [filter]="gridSettings.columnsConfig[6].filter" [filterable]="gridSettings.columnsConfig[6].filterable"
          [format]="gridSettings.columnsConfig[6].format"  [headerStyle]="{'text-align': 'center'}"
          [style]="{'text-align': 'center'}">
          <ng-template kendoGridCellTemplate let-dataItem="dataItem">
            <span *ngIf="dataItem.LastConnection">{{dataItem.LastConnection}}</span>
            <span *ngIf="!dataItem.LastConnection">-</span>
          </ng-template>
        </kendo-grid-column>
        <!-- End Company associated -->
        <kendo-grid-column *ngIf="!isMasterUsersList" [field]="gridSettings.columnsConfig[7].field"
          [title]="gridSettings.columnsConfig[7].title | translate" [width]="gridSettings.columnsConfig[7]._width"
          [filter]="gridSettings.columnsConfig[7].filter" [filterable]="gridSettings.columnsConfig[7].filterable"
          [format]="gridSettings.columnsConfig[7].format" [style]="{'text-align': 'center'}">
          <ng-template kendoGridCellTemplate let-dataItem='dataItem'>
            <span *ngIf="dataItem.IsActif" class="badge badge-success">{{'ACTIVE'|translate}}</span>
            <span *ngIf="!dataItem.IsActif" class="badge badge-danger">{{'INACTIVE'|translate}}</span>
          </ng-template>
        </kendo-grid-column>
        <kendo-grid-column *ngIf="!isMasterUsersList" [field]="gridSettings.columnsConfig[8].field"
                           [title]="gridSettings.columnsConfig[8].title | translate"
                           [width]="gridSettings.columnsConfig[8]._width"
                           [filter]="gridSettings.columnsConfig[8].filter"
                           [filterable]="gridSettings.columnsConfig[8].filterable"
                           [format]="gridSettings.columnsConfig[8].format">
          <ng-template kendoGridHeaderTemplate>
            <span tooltip="{{gridSettings.columnsConfig[8].title|translate}}"
                  theme="light">{{gridSettings.columnsConfig[8].title|translate}}</span>
          </ng-template>
          <ng-template kendoGridCellTemplate let-dataItem="dataItem">
            <span *ngIf="dataItem.LastConnectedIpAdress">{{dataItem.LastConnectedIpAdress}}</span>
            <span *ngIf="!dataItem.LastConnectedIpAdress">-</span>
          </ng-template>
        </kendo-grid-column>
        <kendo-grid-column *ngIf="isMasterUsersList" [field]="gridSettings.columnsConfig[9].field"
          [title]="gridSettings.columnsConfig[9].title | translate" [width]="gridSettings.columnsConfig[9]._width"
          [filter]="gridSettings.columnsConfig[9].filter" [filterable]="gridSettings.columnsConfig[9].filterable"
          [format]="gridSettings.columnsConfig[9].format">
          <ng-template kendoGridHeaderTemplate>
            <span tooltip="{{gridSettings.columnsConfig[9].title|translate}}"
              theme="light">{{gridSettings.columnsConfig[9].title|translate}}</span>
          </ng-template>
          <ng-template kendoGridCellTemplate let-dataItem="dataItem">
            <span *ngIf="dataItem.LastConnectedCompany">{{dataItem.LastConnectedCompany}}</span>
            <span *ngIf="!dataItem.LastConnectedCompany">-</span>
          </ng-template>
        </kendo-grid-column>
        <!-- Command-->
        <kendo-grid-command-column [width]="170" [title]="'ACTIONS'| translate " [columnMenu]="false"
                                   [headerStyle]="{'text-align': 'center'}" [style]="{'text-align': 'center'}">
          <ng-template kendoGridCellTemplate let-isNew="isNew" let-dataItem="dataItem">
            <!-- edit command directive, will be visible when not in edit mode -->
            <i *ngIf="!isMasterUsersList && (hasUpdatePermission || hasShowPermission)" (click)="goToAdvancedEdit(dataItem)"
               class="las la-pen cursor-pointer edit-pencil la-lg"></i>
            <!-- remove command directive, will be visible when not in edit mode -->
            <i *ngIf="!isMasterUsersList && !dataItem.IsUserOnline && !dataItem.HasLeaveOrTimesheet && hasDeletePermission"
               class="fa fa-trash-o la-lg cursor-pointer text-danger" (click)="removeHandler(dataItem.Email)"></i>

            <i *ngIf="!isMasterUsersList && !dataItem.IsUserOnline && dataItem.IsActif && hasDesactivatePermission"
               (click)="openDesactivateusersdetails(true, [dataItem.Id])"
               class=" fa fa-ban fa-lg AddIcon cursor-pointer text-danger" tooltip="{{'DESACTIVATE'|translate}}"
            ></i>

            <i *ngIf="!isMasterUsersList && !dataItem.IsUserOnline && !dataItem.IsActif && hasReactivatePermission"
               (click)="openDesactivateusersdetails(false, [dataItem.Id])"
               class=" fa fa-refresh fa-lg cursor-pointer k-text-success" tooltip="{{'REACTIVATE'|translate}}"></i>

              <i *ngIf="!isMasterUsersList && !dataItem.IsUserOnline" class="icon-logout fa-lg cursor-pointer" tooltip="{{'DISCONNECT' | translate}}" (click)="disconnectUser(dataItem.Email)"></i>


            <!--remove button master user -->
            <button class="noPadding btn-Add k-button" dir="ltr" style="border: none; color: #E91E63 !important;"
                    type="button" *ngIf="isMasterUsersList && dataItem.MasterUserInCompany && !dataItem.IsUserOnline"
                    (click)="removeHandler(dataItem.Email)">
              <i aria-hidden="true" class="cursor-pointer fa fa-trash-o la-lg text-danger"></i>
            </button>
            <!---->
            <button class="noPadding btn-Add k-button" dir="ltr" style="border: none" type="button"
                    *ngIf="isMasterUsersList && !dataItem.MasterUserInCompany && !dataItem.IsUserOnline"
                    (click)="addRoleToMasterUser(dataItem)">
              <i aria-hidden="true" class="cursor-pointer fa fa-plus fa-sm AddIcon"></i>
            </button>

          </ng-template>
        </kendo-grid-command-column>
        <app-grid-export [gridSettings]="gridSettings" fileName="{{'LIST_USER'|translate}}" pdf="true" excel="true"
                         [service]="userService" [predicate]="predicate">
        </app-grid-export>
      </kendo-grid>
    </div>
  </div>
</div>
<div class="overlay" style="z-index: 9000;"
     [ngClass]="{'grid-importer-show':dataImported, 'grid-importer-hide': !dataImported}">
  <a class="closebtn" (click)="onClosePopupImport()" style="z-index:999">&times;</a>
  <div class="overlay-content" *ngIf="dataImported">
    <app-grid-import [importResult]="importData" [saveImportedData]="saveImportedData.bind(this)"
                     [formGroup]="formGroup" [importColumnsConfig]="importColumnsConfig"></app-grid-import>
  </div>
</div>
