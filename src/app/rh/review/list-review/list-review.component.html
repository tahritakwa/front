<div class="card">
  <div class="card-header header_template">
    <div class="col-sm-5 mt-1">
      <h3 class="card-title mb-0">{{'LIST_OF_ANNUAL_INTERVIEWS'|translate}}</h3>
    </div>
  </div>
  <form class="form-horizontal" [formGroup]="reviewFilterFormGroup">
    <div class="row" style="margin-top: 20px; margin-right: 20px; margin-left: 20px;">



      <div class="col-lg-3 col-md-6 col-sm-12">
        <label style="padding-left: 10px;">{{'STATE'|translate}}</label>
        <kendo-dropdownlist class="form-control" [data]="statusFilter" textField="name" valueField="id"
                            [defaultItem]="defaultStatus" (valueChange)="onStatusFilterChanged($event)">
          <ng-template kendoDropDownListItemTemplate kendoDropDownListValueTemplate let-dataItem>
            {{ dataItem?.name | translate }}
          </ng-template>
        </kendo-dropdownlist>
      </div>

      <div class="col-lg-3 col-md-6 col-sm-12" *ngIf="!hideEmployeeDropDown">
        <label>{{'EMPLOYEE' | translate}}</label>
        <div *ngIf="hasAllRights; then thenAllEmployeeBlock else elseHierrarchyEmployee"></div>
        <ng-template #thenAllEmployeeBlock>
          <app-employee-dropdown (Selected)="onDropdownEmployeeSelected($event)"></app-employee-dropdown>
        </ng-template>
        <ng-template #elseHierrarchyEmployee>
          <app-employee-dropdown [hierarchy]="true" [withTheSuperior]="true" [withTeamCollaborater]="true"
                                 (Selected)="onDropdownEmployeeSelected($event)" (hasNotInferior)="hideTheEmployeeDropdown()">
          </app-employee-dropdown>
        </ng-template>
      </div>

      <div class="col-lg-3 col-md-6 col-sm-12">
        <label style="padding-left: 10px;">{{'START_DATE'|translate}}</label>
        <kendo-datepicker class="form-control" [value]="startDateFilter" (valueChange)="changeStartDate($event)"
                          formControlName="startDate" onkeydown="return false;">
          <kendo-datepicker-messages today="{{ 'TODAY' | translate}}" toggle="Cambiar calendario">
          </kendo-datepicker-messages>
        </kendo-datepicker>
      </div>

      <div class="col-lg-3 col-md-6 col-sm-12">
        <label style="padding-left: 10px;">{{'END_DATE'|translate}}</label>
        <kendo-datepicker class="form-control" [value]="endDateFilter" (valueChange)="changeEndDate($event)"
                          formControlName="endDate" onkeydown="return false;">
          <kendo-datepicker-messages today="{{ 'TODAY' | translate}}" toggle="Cambiar calendario">
          </kendo-datepicker-messages>
        </kendo-datepicker>
      </div>
    </div>
  </form>


  <div class="card-body">
    <form class="form-horizontal">
      <kendo-grid [data]="gridSettings.gridData" [pageSize]="gridSettings.state.take" [skip]="gridSettings.state.skip"
                  [sortable]="true" [pageable]="pagerSettings" [reorderable]="true" 
                  [sort]="gridSettings.state.sort" [selectable]="true" [filter]="gridSettings.state.filter" kendoGridSelectBy [selectedKeys]="mySelection"
                  (dataStateChange)="dataStateChange($event)" (cellClick)=setSelectedReview($event)>

        <!-- Head Start-->
        <ng-template kendoGridToolbarTemplate>
          <div class="row toolbar_template">
            <app-btn-grid [advencedAdd]='false' [add]='false' [export]='true' [addLink]='"add"'
                          style="display: inline-flex;"></app-btn-grid>
          </div>
        </ng-template>
        <!-- Head end-->

        <!-- detail template-->
        <ng-template kendoGridDetailTemplate let-dataItem="dataItem">



          <!-- employee information -->
          <section>
            <div class="card-title">
              <h4 style="margin-top: 10px">
                {{'EMPLOYEE_INFORMATION'|translate}}
              </h4>
            </div>

            <div class="card-body">
              <div class="row">
                <div class="col-6"><b>{{'HIRING_DATE'|translate}}</b>:
                  {{dataItem.IdEmployeeCollaboratorNavigation.HiringDate | date:formatDate}}
                </div>
                <div class="col-6"><b>{{'EMAIL'|translate}}</b>:
                  {{dataItem.IdEmployeeCollaboratorNavigation.Email}}
                </div>
              </div>

              <div class="row">
                <div class="col-6"><b>{{'PERSONAL_PHONE'|translate}}</b>:
                  {{dataItem.IdEmployeeCollaboratorNavigation.PersonalPhone}}
                </div>
                <div class="col-6"><b>{{'PROFESSIONAL_PHONE'|translate}}</b>:
                  {{dataItem.IdEmployeeCollaboratorNavigation.ProfessionalPhone}}
                </div>
              </div>
            </div>

          </section>

          <section *ngIf="!dataItem.Interview">
            <div class="noInterview">{{'INTERVIEW_NOT_PLANNED'|translate}}</div>
          </section>

        </ng-template>
        <!--Full Name-->
        <kendo-grid-column [field]="gridSettings.columnsConfig[0].field"
                           [title]="gridSettings.columnsConfig[0].title | translate" [width]="gridSettings.columnsConfig[0]._width"
                           [filter]="gridSettings.columnsConfig[0].filter" [filterable]="gridSettings.columnsConfig[0].filterable"
                           [format]="gridSettings.columnsConfig[0].format">
          <ng-template kendoGridHeaderTemplate>
            <span tooltip="{{gridSettings.columnsConfig[0].tooltip|translate}}"
                  theme="light">{{gridSettings.columnsConfig[0].title|translate}}</span>
          </ng-template>
        </kendo-grid-column>
        <!-- Date -->
        <kendo-grid-column [field]="gridSettings.columnsConfig[1].field"
                           [title]="gridSettings.columnsConfig[1].title | translate" [width]="gridSettings.columnsConfig[1]._width"
                           [filter]="gridSettings.columnsConfig[1].filter" [filterable]="gridSettings.columnsConfig[1].filterable"
                           [format]="gridSettings.columnsConfig[1].format">
          <ng-template kendoGridHeaderTemplate>
            <span tooltip="{{gridSettings.columnsConfig[1].tooltip|translate}}"
                  theme="light">{{gridSettings.columnsConfig[1].title|translate}}</span>
          </ng-template>
          <ng-template kendoGridCellTemplate let-dataItem="dataItem">
            <span *ngIf="dataItem.ReviewDate">
              {{dataItem.ReviewDate | date: gridSettings.columnsConfig[1].format}}
            </span>
            <span *ngIf="!dataItem.ReviewDate">
              {{'N/A'|translate}}
            </span>
          </ng-template>
        </kendo-grid-column>
        <!--Manager-->
        <kendo-grid-column [field]="gridSettings.columnsConfig[2].field"
                           [title]="gridSettings.columnsConfig[2].title | translate" [width]="gridSettings.columnsConfig[2]._width"
                           [filter]="gridSettings.columnsConfig[2].filter" [filterable]="gridSettings.columnsConfig[2].filterable"
                           [format]="gridSettings.columnsConfig[2].format">
          <ng-template kendoGridHeaderTemplate>
            <span tooltip="{{gridSettings.columnsConfig[2].tooltip|translate}}"
                  theme="light">{{gridSettings.columnsConfig[2].title|translate}}</span>
          </ng-template>
        </kendo-grid-column>
        <!--State-->
        <kendo-grid-column [field]="gridSettings.columnsConfig[3].field"
                           [title]="gridSettings.columnsConfig[3].title | translate" [width]="gridSettings.columnsConfig[3]._width"
                           [filter]="gridSettings.columnsConfig[3].filter" [filterable]="gridSettings.columnsConfig[3].filterable"
                           [format]="gridSettings.columnsConfig[3].format">
          <ng-template kendoGridHeaderTemplate>
            <span tooltip="{{gridSettings.columnsConfig[3].tooltip|translate}}"
                  theme="light">{{gridSettings.columnsConfig[3].title|translate}}</span>
          </ng-template>                 
          <ng-template kendoGridCellTemplate let-dataItem="dataItem">
            <div *ngIf="dataItem.State == reviewState.ToPlan"><span
              class="badge badge-secondary">{{'TO_PLAN'|translate}}</span></div>
            <div *ngIf="dataItem.State == reviewState.InProgress"><span
              class="badge badge-primary">{{'IN_PROGRESS_REVIEW'|translate}}</span>
            </div>
            <div *ngIf="dataItem.State == reviewState.Completed"><span
              class="badge badge-success">{{'COMPLETED'|translate}}</span></div>
            <div *ngIf="dataItem.State == reviewState.NotPlanned"><span
              class="badge badge-light">{{'NOT_PLANNED'|translate}}</span></div>
          </ng-template>
        </kendo-grid-column>

        <!--form manager-->
        <kendo-grid-column [field]="gridSettings.columnsConfig[4].field"
                           [title]="gridSettings.columnsConfig[4].title | translate" [width]="gridSettings.columnsConfig[4]._width"
                           [filter]="gridSettings.columnsConfig[4].filter" [filterable]="gridSettings.columnsConfig[4].filterable"
                           [format]="gridSettings.columnsConfig[4].format">
          <ng-template kendoGridHeaderTemplate>
            <span tooltip="{{gridSettings.columnsConfig[4].tooltip|translate}}"
                  theme="light">{{gridSettings.columnsConfig[4].title|translate}}</span>
          </ng-template>
          <ng-template kendoGridCellTemplate let-dataItem>
            <div class="right-margin" *ngIf="dataItem.FormManager == formValidationState.Done"><span
              class="badge badge-success"><i class="fa fa-check"></i></span></div>
            <div class="right-margin" *ngIf="dataItem.FormManager == formValidationState.Partial"><span
              class="badge badge-warning"><i class="fa fa-exclamation"></i></span></div>
            <div class="right-margin"
                 *ngIf="dataItem.FormManager == null || dataItem.FormManager == formValidationState.New">
              <span class="badge badge-danger" style="text-align:center">
                <i class="fa fa-close" style="width: 13px;height:11px;"></i>
              </span>
            </div>
          </ng-template>
        </kendo-grid-column>

        <!--form employee-->
        <kendo-grid-column [field]="gridSettings.columnsConfig[5].field"
                           [title]="gridSettings.columnsConfig[5].title | translate" [width]="gridSettings.columnsConfig[5]._width"
                           [filter]="gridSettings.columnsConfig[5].filter" [filterable]="gridSettings.columnsConfig[5].filterable"
                           [format]="gridSettings.columnsConfig[5].format">
          <ng-template kendoGridHeaderTemplate>
            <span tooltip="{{gridSettings.columnsConfig[5].tooltip|translate}}"
                  theme="light">{{gridSettings.columnsConfig[5].title|translate}}</span>
          </ng-template>
          <ng-template kendoGridCellTemplate let-dataItem>
            <div class="right-margin" *ngIf="dataItem.FormEmployee == formValidationState.Done"><span
              class="badge badge-success"><i class="fa fa-check"></i></span></div>
            <div class="right-margin" *ngIf="dataItem.FormEmployee == formValidationState.Partial"><span
              class="badge badge-warning"><i class="fa fa-exclamation"></i></span></div>
            <div class="right-margin"
                 *ngIf="dataItem.FormEmployee == null || dataItem.FormEmployee == formValidationState.New">
              <span class="badge badge-danger" style="text-align:center">
                <i class="fa fa-close" style="width: 13px;height:11px;"></i>
              </span>
            </div>
          </ng-template>
        </kendo-grid-column>

        <!-- Command-->
        <kendo-grid-command-column [width]="140">
          <ng-template kendoGridCellTemplate let-dataItem="dataItem">
            <div *ngIf="dataItem.State != 4">
              <!--Open advanced edit form -->
              <button (click)="goToAdvancedEdit(dataItem.Id)" *ngIf="hasShowReviewPermission"
              style="background-color: transparent;">
                <i class="las la-pen cursor-pointer edit-pencil la-lg" tooltip="{{'UPDATE'|translate}}"></i>
              </button>
              <!--Open physical review form -->
              <button type="submit" *ngIf="hasAddInterviewPermission || (dataItem.IdManager === connectedEmployee.Id)"
                      (click)="openPhysicalReviewModal(dataItem)" type="submit" style="background-color:transparent;">
                <i class="fa fa-calendar-plus-o" tooltip="{{'ADD_PHYSICAL_INTERVIEW'|translate}}" style="color: #4dbd74;"></i>
              </button>
            </div>

            <div *ngIf="dataItem.State == 4">
              <button *ngIf="hasAddReviewPermission" (click)="addReview(dataItem)" class="btn" style="background-color:transparent;">
                <i class="fa fa-plus" tooltip="{{'PLANIFY'|translate}}" style="color: #20a8d8;"></i>
              </button>
            </div>
          </ng-template>
        </kendo-grid-command-column>
        <!--grid pdf & excel-->
        <app-grid-export [gridSettings]="gridSettings" fileName="{{'LIST_OF_ANNUAL_INTERVIEWS'|translate}}" pdf="true"
                         excel="true" [service]="reviewService" [predicate]="predicate">
        </app-grid-export>
        <!--end grid pdf & excel-->
      </kendo-grid>
    </form>
  </div>

</div>

<app-list-interview-accordion *ngIf = "hasShowInterviewPermission" [(review)]="selectedReview"></app-list-interview-accordion>
