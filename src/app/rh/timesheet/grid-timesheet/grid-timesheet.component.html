<div class="card">
  <div class="card-header">
    <div class="col-sm-5 mt-1">
      <h3 class="card-title mb-0">{{'LIST_TIMESHEET'|translate}}</h3>
    </div>
  </div>
  <!--Begin Card body-->
  <div class="card-body">
    <div class="col-lg-12 col-md-12 col-sm-12">
      <div>

    <form class="form-horizontal">
      <app-advanced-search [filtreFieldsColumns]="filtreFieldsColumns" [filtreFieldsInputs]="filtreFieldsInputs"
      (filtrePredicateToSend)="getFiltrePredicate($event)" (predicateOperator)="getOperatorPredicate($event)"
      (searchClickEvent)="initGridDataSource()" (resetClickEvent)="resetClickEvent()">
    </app-advanced-search>
    
    <div class="row" style="margin-right: 40px; margin-top: 5px;">
                
      <div 
        class="row" style="margin-left: auto;">
        <app-action-dropdown [Actions]="listOfAction" *ngIf="hasMassiveFixPermission || hasMassiveValidatePermission" [selectedStatus]="selectedStatus" [selectionLength]="selectionLength" (selectedValue)="selectedAction($event)" style="margin-right: 15px;"></app-action-dropdown>
      </div>
      <app-btn-grid [addLink]='"add"' [add]='false' [advencedAdd]='false' [export]='true'
      style="margin-top: -5%;display: inline-flex;"></app-btn-grid>
    </div>
    <div class="row d-flex justify-content-between mt-3">
      
    </div>
    <br/>
    <br/>
      <kendo-grid (dataStateChange)="dataStateChange($event)" (edit)="goToAdvancedEdit($event)" (filterChange)="filterChange($event)"
                  (remove)="deleteTimeSheet($event)" (selectedKeysChange)="onSelectedKeysChange($event)" [data]="gridSettings.gridData"
                  [filter]="gridSettings.state.filter" [filterable]="true"
                  [kendoGridSelectBy]="'Id'"
                  [pageSize]="gridSettings.state.take" [pageable]="pagerSettings" [selectable]="{enabled: true, checkboxOnly: true , mode:'multiple'}"
                  [selectedKeys]="timesheetIdsSelected"
                  [skip]="gridSettings.state.skip"
                  [sort]="gridSettings.state.sort" [sortable]="true">
        <!-- Checkbox -->
      <!--Check box Start -->
      <kendo-grid-checkbox-column [width]="80" *ngIf="hasMassiveFixPermission || hasMassiveValidatePermission">
        <ng-template kendoGridHeaderTemplate>
          <input class="k-checkbox" id="selectAllCheckboxId" kendoGridSelectAllCheckbox [state]="selectAllState" (selectAllChange)="onSelectAllChange($event)">
          <label class="k-checkbox-label" for="selectAllCheckboxId"></label>
        </ng-template>
      </kendo-grid-checkbox-column>
      <!--Check box End -->
        <!--First Name Nav-->
        <kendo-grid-column [field]="gridSettings.columnsConfig[0].field" [filter]="gridSettings.columnsConfig[0].filter"
                           [filterable]="gridSettings.columnsConfig[0].filterable"  [columnMenu]="false"
                           [format]="gridSettings.columnsConfig[0].format"
                           [title]="gridSettings.columnsConfig[0].title | translate"
                           [width]="gridSettings.columnsConfig[0]._width">
        </kendo-grid-column>
        <!--Last Name Nav-->
        <kendo-grid-column [field]="gridSettings.columnsConfig[1].field" [filter]="gridSettings.columnsConfig[1].filter"
                           [filterable]="gridSettings.columnsConfig[1].filterable" [columnMenu]="false"
                           [format]="gridSettings.columnsConfig[1].format"
                           [title]="gridSettings.columnsConfig[1].title | translate"
                           [width]="gridSettings.columnsConfig[1]._width">
        </kendo-grid-column>
        <!-- Treated by -->
        <kendo-grid-column [field]="gridSettings.columnsConfig[3].field" [filter]="gridSettings.columnsConfig[3].filter"
                           [filterable]="gridSettings.columnsConfig[3].filterable" [columnMenu]="false"
                           [format]="gridSettings.columnsConfig[3].format"
                           [title]="gridSettings.columnsConfig[3].title | translate"
                           [width]="gridSettings.columnsConfig[3]._width">
        </kendo-grid-column>
        <!--Treatment day -->
        <kendo-grid-column [field]="gridSettings.columnsConfig[4].field" [width]="gridSettings.columnsConfig[4]._width"
          [filter]="gridSettings.columnsConfig[4].filter" [filterable]="gridSettings.columnsConfig[4].filterable" [columnMenu]="false"
          [format]="gridSettings.columnsConfig[4].format" [title]="gridSettings.columnsConfig[4].title | translate">
          <ng-template kendoGridFilterCellTemplate let-filter let-column="column">
            <kendo-grid-date-filter-cell [format]="formatDate" [column]="column" [filter]="filter"
              [operator]="equals" (click)="translateToday()">
              <kendo-filter-eq-operator></kendo-filter-eq-operator>
            </kendo-grid-date-filter-cell>
          </ng-template>
          <ng-template kendoGridCellTemplate let-dataItem="dataItem">
            {{dataItem.TreatmentDate | date: gridSettings.columnsConfig[4].format}}
          </ng-template>
        </kendo-grid-column>
        <!--Status enum -->
        <kendo-grid-column [field]="gridSettings.columnsConfig[5].field" [filter]="gridSettings.columnsConfig[5].filter"
                           [filterable]="gridSettings.columnsConfig[5].filterable"
                           [format]="gridSettings.columnsConfig[5].format" [columnMenu]="false"
                           [title]="gridSettings.columnsConfig[5].title | translate"
                           [width]="gridSettings.columnsConfig[5]._width">
          <ng-template kendoGridFilterCellTemplate let-column="column" let-filter>
            <app-status-dropdown (selectedValue)="statusGridFilte($event)" [form]="statusSearchDropdownFormGroup"
                                 [timeSheetEnum]="true"></app-status-dropdown>
          </ng-template>
          <ng-template kendoGridCellTemplate let-dataItem>
            <span *ngIf="dataItem.Status === statusCode.ToDo" class="badge badge-dark status-badge">
              {{'TODO'|translate}}
            </span>
            <span *ngIf="dataItem.Status === statusCode.Draft" class="badge badge-warning status-badge">
              {{'DRAFT'|translate}}
            </span>
            <span *ngIf="dataItem.Status === statusCode.Sended" class="badge badge-primary status-badge">
              {{'SENDED'|translate}}
            </span>
            <span *ngIf="dataItem.Status === statusCode.Validated" class="badge badge-success status-badge">
              {{'VALID'|translate}}
            </span>
            <span *ngIf="dataItem.Status === statusCode.PartiallyValidated" class="badge badge-success status-badge">
              {{'PARTIALLY_VALID'|translate}}
            </span>
            <span *ngIf="dataItem.Status === statusCode.ToReWork" class="badge badge-danger status-badge">
              {{'TOREWORK'|translate}}
            </span>
            <i (click)="infoTimesheet(dataItem)" *ngIf="dataItem.Status !== statusCode.ToDo"
               class="fa fa-info-circle fa-lg"
               style="text-align: center;padding: 0; color: #4c9aae;cursor: pointer;float: right;"></i>
          </ng-template>
        </kendo-grid-column>
        <!-- Command-->
        <kendo-grid-command-column [width]="150" [columnMenu]="false">
          <ng-template kendoGridCellTemplate let-dataItem="dataItem" let-isNew="isNew">
            <!-- edit command directive, will be visible when permission exist-->
            <i class="las la-pen cursor-pointer edit-pencil la-lg" aria-hidden="true" 
            *ngIf="((hasShowPermission && dataItem.Status !== statusCode.ToDo) || (hasAddPermission && dataItem.Status === statusCode.ToDo))
              && (dataItem.IsConnectedUserInHierarchy || dataItem.IdEmployee === connectedEmployee)"
              (click)="goToAdvancedEdit(dataItem)"></i>
            <!-- validate command directive, will be visible when permission exist -->
              <i class="fa fa-check btnKendoGrid cursor-pointer" *ngIf="(hasValidatePermission || dataItem.IsConnectedUserInHierarchy) && dataItem.IdEmployee !== connectedEmployee
              && (dataItem.Status === statusCode.Draft || dataItem.Status === statusCode.Sended || dataItem.Status === statusCode.PartiallyValidated)"
              (click)="validateTimesheet(dataItem)"></i>
            <!-- remove command directive, will be visible when permission exist -->
            <i class="fa fa-trash-o la-lg mx-2 text-danger" aria-hidden="true" *ngIf="dataItem.Status === statusEnumDraft && hasDeletePermission"
            (click)="removeHandler(dataItem)"></i>
            <i class="fa fa-envelope"  *ngIf="dataItem.Status === statusCode.ToDo && hasEmailSendingPermission"
              tooltip=" {{'SEND_REQUEST_TO_FILL_TIMESHEET'|translate}}" (click)="SendMail(dataItem)" aria-hidden="true"></i>
          </ng-template>
        </kendo-grid-command-column>
        <!--grid pdf & excel-->
        <app-grid-export [gridSettings]="gridSettings" [predicate]="predicate" [service]="timeSheetService" excel="true"
                         fileName="{{'LIST_TIMESHEET'|translate}}" pdf="true">
        </app-grid-export>
        <!--end grid pdf & excel-->
      </kendo-grid>
    </form>
  </div>
  </div>
</div>
</div>