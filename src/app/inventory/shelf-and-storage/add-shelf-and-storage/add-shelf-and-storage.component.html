<div class="card">
  <form class="form-horizontal" [formGroup]="transfertMovementForm">
    <div class="card-header d-flex justify-content-between">
      <h4 class="card-title">
        {{(isUpdateMode ? 'EDIT_TRANSFERT_MOVEMENT' : 'ADD_TRANSFERT_MOVEMENT')|translate}}
      </h4>
      <span *ngIf="isVisibleTransferMovementCode" class="transferMovementCode">
         {{CodeMovmentTransfet.value}}
        <i *ngIf="checkDeletePossibility() && hasDeletePermission" style="margin-top: 10px;"
           class="las la-trash-alt text-danger cursor-pointer la-lg" aria-hidden="true" (click)="removeHandler()"></i>
         </span>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-sm-12 col-md-12 col-lg-12">
          <div class="col-lg-12 col-md-12 col-sm-12" *ngIf="!isUpdateMode">
            <div class="form-group row" style="justify-content: left">
              <div class="col-sm-12 col-md-6 col-lg-2">
                <button [ngClass]="isAccociationSelected?'btn btn-pill btn-block btn-warning':'btn btn-pill btn-block btn-secondary'"
                        (click)="changeTransfertType(0)">{{'ASSOCIATION_LABEL'|translate}}</button>
              </div>
              <div class="col-sm-12 col-md-6 col-lg-2">
                <button [ngClass]="isAccociationSelected ?'btn btn-pill btn-block btn-secondary':'btn btn-pill btn-block btn-warning'"
                        (click)="changeTransfertType(1)">{{'TRANSFERT_LABEL'|translate}}</button>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-12">
          <label class="col-lg-12 col-md-12 col-sm-12">{{'DOCUMENT_DATE'|translate}}<span
            class="required">*</span></label>
          <div class="col-lg-10 col-md-10 col-sm-12">
            <kendo-datepicker class="form-control" formControlName="DocumentDate" [disabled]='isShowForm'
            (focusout)='changeData()'>
              <kendo-datepicker-messages today="{{ 'TODAY' | translate}}"
                                         toggle="{{ 'CALENDAR.MENU_TITLE' | translate}}">
              </kendo-datepicker-messages>
            </kendo-datepicker>
            <app-control-messages [control]="transfertMovementForm.controls.DocumentDate"
                                  class="error-msg messages text-left text-danger">
            </app-control-messages>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-12">
          <label class="col-lg-12 col-md-12 col-sm-12">{{'WAREHOUSE'|translate}} <span
            class="required">*</span></label>
          <div class="col-lg-10 col-md-10 col-sm-12">
            <app-depot-dropdown [parent]="transfertMovementForm" [FromComponent]='true'
                                [warehouseForInventoryDocument]='true' [WarehouseName]="'IdWarehouseSource'"
                                [disabled]='isDisabled || (isUpdateMode && !hasUpdatePermission)' (Focused)="warehouseSourceFocused($event)"
                                (Selected)="warehouseDestinationSelected($event)"></app-depot-dropdown>
            <app-control-messages [control]="IdWarehouseSource"
                                  class="error-msg messages text-left text-danger">
            </app-control-messages>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-12"  *ngIf="!isAccociationSelected">
          <label class="col-lg-12 col-md-10 col-sm-10">{{'SHELF_SOURCE'|translate}}<span
            class="required">*</span></label>
          <div class="col-lg-10 col-md-10 col-sm-12">
            <app-shelf-dropdown #shelfSourceDropdown [parent]="transfertMovementForm" [shelfName]="'IdStorageSource'"
                                [disabled]="isDisabledShelfDropdown || (isUpdateMode && !hasUpdatePermission)"
                                [idWarehouse]="selectedIdWarehouse"
                                (Selected) = "SelectShelfSource($event)"></app-shelf-dropdown>
            <app-control-messages [control]="IdStorageSource"
                                  class="error-msg messages text-left text-danger">
            </app-control-messages>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-12">
          <label class="col-lg-12 col-md-10 col-sm-10">{{'SHELF_DESTINATION'|translate}}<span
            class="required">*</span></label>
          <div class="col-lg-10 col-md-10 col-sm-12">
            <app-shelf-dropdown #shelfDestinationDropdown [parent]="transfertMovementForm" [shelfName]="'IdStorageDestination'"
                                [disabled]="isDisabledShelfDropdown || (isUpdateMode && !hasUpdatePermission)"
                                [idWarehouse]="selectedIdWarehouse" (Selected)="SelectShelfDestination($event)"></app-shelf-dropdown>
            <app-control-messages [control]="IdStorageDestination"
                                  class="error-msg messages text-left text-danger">
            </app-control-messages>
          </div>
        </div>
      </div>
      <div class="row d-flex justify-content-end m-3">
        <button class="btn btn-sm" *ngIf='!isShowForm && showButtonAddLine && (hasUpdatePermission || (hasAddPermission && !isUpdateMode))' type="button"
                (click)="addLine()" style="background-color: #20a8d8 !important;">
          <i style="color: white" class="fa fa-plus fa AddIcon"></i>
          <span style="color: white">&nbsp; {{'ADD_LINE'|translate}}</span>
        </button>
      </div>
      <kendo-grid (cellClick)="lineClickHandler($event)" (remove)="removeLine($event)" (add)="addLine()"
                  [data]="view" id="productsGrid" [style.maxHeight.px]="400" [pageSize]="pageSize" [skip]="skip"
                  [pageable]="pagerSettings" (pageChange)="pageChange($event)" #grid>
        <kendo-grid-column field="LabelItem" title="{{'ITEM'|translate}}" [width]='100'
                           [editable]='!isShowForm'>
          <ng-template kendoGridEditTemplate let-dataItem="dataItem" *ngIf='isInEditingMode'>
            <app-item-dropdown [itemForm]="formGroup" [warehouseAssociated]="warehouseAssociatedToItems"
                               (Selected)="itemSelect($event)" [showFilter]='true' [hideSearch]='dataItem && dataItem.Id && dataItem.Id > 0'
                               [parentViewContainerRef]="viewRef" [activeKeyPress]='true' #item
                               (keydown.enter)='movementItemFoucusOut()' [isFroSerach]='true' [isForImprovement]="true"
                               [idStockDocument]="id" [idStorage]="selectedStorage" [isForRC]="true">
            </app-item-dropdown>
            <i #anchor></i>
            <app-control-message-grid-cell [group]="formGroup" [anchor]="anchor" controlName="IdItem">
            </app-control-message-grid-cell>
          </ng-template>
          <ng-template kendoGridCellTemplate let-dataItem="dataItem">
            <div class="row">
              <div class="col-auto">
                <div class="item-photo d-flex justify-content-center">
                  <img id="ThumbnailItem" class="imgSize" alt="Illustration des problÃ¨mes de suddation"
                       border="0" [src]="getItemPicture(dataItem) || 'assets/image/placeholder-logo.png'"/>
                </div>
              </div>
              <div class="col mt-2">
                <span>{{dataItem.LabelItem}} - {{dataItem.Designation}}</span>
              </div>
            </div>
          </ng-template>
        </kendo-grid-column>
        <kendo-grid-column field="AvailableQuantity" title="{{'DISPONIBILITY'|translate}}" [width]='130'>
          <ng-template *ngIf='showAvalableQuantite' kendoGridEditTemplate>
            <span class="badge badge-success">
              {{'AVAILABLE_IN_STOCK'|translate}} &nbsp;
              <span>{{this.formGroup.controls['AvailableQuantity'].value}}</span>
            </span>
          </ng-template>
          <ng-template *ngIf='!showAvalableQuantite' kendoGridEditTemplate><span>-</span>
          </ng-template>
          <ng-template kendoGridCellTemplate let-dataItem="dataItem">
               <span
                 class="badge badge-success">{{'AVAILABLE_IN_STOCK'|translate}}&nbsp;{{dataItem.AvailableQuantity}}</span>
          </ng-template>
        </kendo-grid-column>
        <kendo-grid-column field="shelfDestinationLabel"
        title="{{'SHELF_AND_STORAGE_DESTINATION'| translate}}" width="100">
        <ng-template kendoGridHeaderTemplate>
          <span tooltip="{{'SHELF_AND_STORAGE_DESTINATION'| translate}}"
            theme="light">{{'SHELF_AND_STORAGE_DESTINATION'| translate}}</span>
        </ng-template>
        <ng-template kendoGridCellTemplate let-dataItem='dataItem'>
          <span *ngIf="shelfDestinationLabel">{{shelfDestinationLabel}}</span>
          <span *ngIf="!shelfDestinationLabel">-</span>
        </ng-template>
      </kendo-grid-column>
        <kendo-grid-command-column [title]="'ACTIONS'| translate " [width]='100'
        [headerStyle]="{'text-align': 'center'}" [style]="{'text-align': 'center'}">
          <ng-template kendoGridCellTemplate let-isNew="isNew">
            <div class="d-inline-flex w-100">
              <button kendoGridRemoveCommand class="btn-Add k-button" dir="ltr"
                      style="border: none; color: #E91E63 !important;" type="button" *ngIf='!isShowForm && hasUpdatePermission'>
                <i class="fa fa-trash-o la-lg mx-3 text-danger"></i>
              </button>
              <button class='btn-Add p-2' *ngIf="isInEditingMode && !isShowForm" kendoGridSaveCommand
                      id='btnSave' type="button" [disabled]="!isSavedDocument" (click)="saveCurrent()">
                <i class="fa fa-check fa-lg AddIcon" aria-hidden="true"></i>
              </button>
              <button kendoGridCancelCommand *ngIf="isInEditingMode && !isShowForm"
                      class="btn-Add k-button p-2" (click)="cancelHandler($event)" type="button">
                <i class="fa fa-times fa-lg" style="color: #E91E63;" aria-hidden="true"></i>
              </button>
            </div>
          </ng-template>
        </kendo-grid-command-column>
        <div>
          <kendo-grid-messages noRecords="">
          </kendo-grid-messages>
        </div>
      </kendo-grid>
    </div>
  </form>
  <!--Begin Card footer-->
  <div class="fixed-card-footer">
    <div class="footerStyle">
      <footer class="app-footer">
        <div class="w-100">
          <div class="d-flex justify-content-end p-3 footer-content">
            <a routerLink="/main/inventory/ShelfAndStorage">
                  <span class="btn btn-sm btn-back-to-list btn-primary">
                  <i class="fa fa-chevron-circle-left"></i> {{'BACK_TO_LIST'|translate}}
                  </span>
            </a>
            <span>
                  <button type="button" class="btn btn-sm btn-save"
                          *ngIf='isUpdateMode && !isShowForm && hasValidatePermission'
                          [disabled]='isInEditingMode || !isDisabled' (click)="validateTransfertMovement()">
                  <span>
                  <i class="fa fa-check-square-o"></i> {{'VALIDATE'|translate}}
                  </span>
                  </button>
                  <button class="btn btn-sm btn-primary" type="button" *ngIf='isTransfertForm && hasTransferPermission'
                          (click)="transfertValidateStockDocument()">
                  <i class="fa fa-floppy-o"></i> {{'TRANSFERT'|translate}}
                  </button>
                  <button class="btn btn-sm btn-primary" type="button" *ngIf='isReceiveForm && hasReceivePermission'
                          (click)="receiveValidateStockDocument()">
                  <i class="fa fa-floppy-o"></i> {{'RECEIVE'|translate}}
                  </button>
                  </span>
          </div>
        </div>
      </footer>
    </div>
  </div>
  <!--End Card footer-->
</div>
