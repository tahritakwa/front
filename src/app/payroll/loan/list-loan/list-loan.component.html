<div class="col-lg-12 col-md-12 col-sm-12">
  <div class="row">
    <div class="card border-0 full-screen-card">
      <div class="card-content">
        <div class="card-header">
          <div class="col-sm-5 mt-1">
            <h3 class="card-title mb-0">{{'LOAN_ADVANCE_REQUEST_LIST'|translate}}</h3>
          </div>
        </div>
        <div class="card-body" [formGroup]="loanFormGroup">
          <app-advanced-search [filtreFieldsColumns]="filtreFieldsColumns" [filtreFieldsInputs]="filtreFieldsInputs"
            (filtrePredicateToSend)="getFiltrePredicate($event)" (predicateOperator)="getOperatorPredicate($event)"
            (searchClickEvent)="initGridDataSource(false)" (resetClickEvent)="resetClickEvent()">
          </app-advanced-search>
          <div class="row d-flex justify-content-between mt-3">
            <app-search-session class="col-lg-3" (sendData)="receiveData($event)"></app-search-session>
            <app-btn-grid class="col" [advencedAdd]="hasAddPermission" [addLink]='"add"' [relativeStyle]='true' [model]="true"
              [fileName]="'LOAN_ADVANCE_REQUEST_LIST'|translate" [service]="loanService" [predicate]="predicate"
              [isFromDocument]="true" [isExportExcel]="true" [gridSettings]="gridSettings">
            </app-btn-grid>
          </div>
          <form class="form-horizontal">
            <kendo-grid [data]="gridSettings.gridData" [pageSize]="gridSettings.state.take"
              [skip]="gridSettings.state.skip" [sortable]="true" filterable="menu" [reorderable]="true"
              [columnMenu]="true" [sort]="gridSettings.state.sort" [filter]="gridSettings.state.filter"
              (dataStateChange)="dataStateChange($event)" [pageable]="pagerSettings" [selectable]="true">
              <!--Employee-->
              <kendo-grid-column [field]="gridSettings.columnsConfig[0].field"
                [width]="gridSettings.columnsConfig[0]._width" [filter]="gridSettings.columnsConfig[0].filter"
                [filterable]="gridSettings.columnsConfig[0].filterable" [format]="gridSettings.columnsConfig[0].format"
                [columnMenu]="false">
                <ng-template kendoGridHeaderTemplate>
                  <span tooltip="{{gridSettings.columnsConfig[0].title|translate}}"
                    theme="light">{{gridSettings.columnsConfig[0].title|translate}}</span>
                </ng-template>
              </kendo-grid-column>
              <!--Credit Type-->
              <kendo-grid-column [field]="gridSettings.columnsConfig[1].field"
                [width]="gridSettings.columnsConfig[1]._width" [filter]="gridSettings.columnsConfig[1].filter"
                [filterable]="gridSettings.columnsConfig[1].filterable" [format]="gridSettings.columnsConfig[1].format"
                [columnMenu]="false">
                <ng-template kendoGridHeaderTemplate>
                  <span tooltip="{{gridSettings.columnsConfig[1].title|translate}}"
                    theme="light">{{gridSettings.columnsConfig[1].title|translate}}</span>
                </ng-template>
                <ng-template kendoGridCellTemplate let-dataItem="dataItem">
                  <div *ngIf="dataItem.CreditType == creditTypeEnum.Loan">
                    <span>{{"LOAN" | translate}}</span>
                  </div>
                  <div *ngIf="dataItem.CreditType == creditTypeEnum.Advance">
                    <span>{{"ADVANCE" | translate}}</span>
                  </div>
                </ng-template>
              </kendo-grid-column>
              <!--Amount-->
              <kendo-grid-column [field]="gridSettings.columnsConfig[2].field"
                [width]="gridSettings.columnsConfig[2]._width" [filter]="gridSettings.columnsConfig[2].filter"
                [filterable]="gridSettings.columnsConfig[2].filterable" [format]="gridSettings.columnsConfig[2].format"
                [columnMenu]="false">
                <ng-template kendoGridHeaderTemplate>
                  <span tooltip="{{gridSettings.columnsConfig[2].title|translate}}"
                    theme="light">{{gridSettings.columnsConfig[2].title|translate}}</span>
                </ng-template>
              </kendo-grid-column>
              <!--ObtainingDate-->
              <kendo-grid-column [field]="gridSettings.columnsConfig[3].field"
                [title]="gridSettings.columnsConfig[3].title | translate" [width]="gridSettings.columnsConfig[3]._width"
                [filter]="gridSettings.columnsConfig[3].filter" [filterable]="gridSettings.columnsConfig[3].filterable"
                [format]="gridSettings.columnsConfig[3].format" [columnMenu]="false">
                <ng-template kendoGridHeaderTemplate>
                  <span tooltip="{{gridSettings.columnsConfig[3].title|translate}}"
                    theme="light">{{gridSettings.columnsConfig[3].title|translate}}</span>
                </ng-template>
                <ng-template kendoGridCellTemplate let-dataItem>
                  {{dataItem.ObtainingDate | date:formatDate}}
                </ng-template>
              </kendo-grid-column>
              <!--MonthsNumber-->
              <kendo-grid-column [field]="gridSettings.columnsConfig[4].field"
                [title]="gridSettings.columnsConfig[4].title | translate" [width]="gridSettings.columnsConfig[4]._width"
                [filter]="gridSettings.columnsConfig[4].filter" [filterable]="gridSettings.columnsConfig[4].filterable"
                [format]="gridSettings.columnsConfig[4].format" [columnMenu]="false">
                <ng-template kendoGridHeaderTemplate>
                  <span tooltip="{{gridSettings.columnsConfig[4].title|translate}}"
                    theme="light">{{gridSettings.columnsConfig[4].title|translate}}</span>
                </ng-template>
              </kendo-grid-column>
              <!--State-->
              <kendo-grid-column [field]="gridSettings.columnsConfig[5].field"
                [width]="gridSettings.columnsConfig[5]._width" [filter]="gridSettings.columnsConfig[5].filter"
                [filterable]="gridSettings.columnsConfig[5].filterable" [format]="gridSettings.columnsConfig[5].format"
                [title]="gridSettings.columnsConfig[5].title | translate" [columnMenu]="false">
                <ng-template kendoGridCellTemplate let-dataItem="dataItem">
                  <ng-template kendoGridHeaderTemplate>
                    <span tooltip="{{gridSettings.columnsConfig[5].title|translate}}"
                      theme="light">{{gridSettings.columnsConfig[5].title|translate}}</span>
                  </ng-template>
                  <div *ngIf="dataItem.State == statusCode.Waiting">
                    <span class="badge badge-warning">{{"WAITING" | translate}}</span>
                  </div>
                  <div *ngIf="dataItem.State == statusCode.Accepted">
                    <span class="badge badge-success">{{"ACCEPTED" | translate}}</span>
                  </div>
                  <div *ngIf="dataItem.State == statusCode.Refused">
                    <span class="badge badge-danger">{{"REFUSED" | translate}}</span>
                  </div>
                </ng-template>
              </kendo-grid-column>
              <app-grid-export [gridSettings]="gridSettings" fileName="{{'REQUEST_LIST'|translate}}" pdf="true"
                excel="true" [service]="loanService" [predicate]="predicate">
              </app-grid-export>
              <!--end grid pdf & excel-->
              <!-- Command-->
              <kendo-grid-command-column [width]="170" [title]="'ACTIONS'| translate " [columnMenu]="false"
                [headerStyle]="{'text-align': 'center'}" [style]="{'text-align': 'center'}">
                <ng-template kendoGridCellTemplate let-isNew="isNew" let-dataItem="dataItem">
                  <!--Open advanced edit form -->
                  <!-- edit command directive, will be visible when not in edit mode -->
                  <div *ngIf="dataItem.State === statusCode.Waiting; then thenCanEdit  else thenCanNotEdit"></div>
                  <ng-template #thenCanEdit>
                    <i class="k-button btnKendoGrid editBtn" (click)="goToAdvancedEdit(dataItem)" *ngIf="hasShowPermission || hasUpdatePermission" 
                      class="las la-pen cursor-pointer edit-pencil la-lg pr-1" tooltip="{{'UPDATE'|translate}}"></i>
                  </ng-template>
                  <ng-template #thenCanNotEdit>
                    <i (click)="goToAdvancedEdit(dataItem)" *ngIf="hasShowPermission || hasUpdatePermission" class="las la-pen cursor-pointer edit-pencil la-lg"></i>
                  </ng-template>
                  <!-- remove command directive, will be visible when not in edit mode -->
                  <i *ngIf="hasDeletePermission && dataItem.State === statusCode.Waiting" (click)="removeHandler(dataItem)"
                    class="btnKendoGrid" class="fa fa-trash-o la-lg cursor-pointer text-danger" tooltip="{{'DELETE'|translate}}">
                  </i>
                </ng-template>
              </kendo-grid-command-column>

              <!-- column select -->
              <kendo-grid-command-column [width]="50" [columnMenu]="true">
              </kendo-grid-command-column>
              <!--End Columns-->
            </kendo-grid>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
